<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.kh.team2.dao.MemberDAO">


	<!-- =============================== INSERT =============================== -->

	<insert id="insertMember">
		INSERT INTO member(me_id, me_ms_state, me_ma_auth, me_pw, me_nickname, me_name, me_phone, me_address, me_type)
			VALUE(#{member.me_id}, "이용중", "일반", #{member.me_pw}, #{member.me_nickname}, #{member.me_name}, #{member.me_phone}, #{member.me_address}, 0)
	</insert>	
	
	<insert id="insertMemberVerify">
		INSERT INTO me_verify value(#{mv.mv_me_id},#{mv.mv_code},DATE_ADD(NOW(), INTERVAL 3 MINUTE),now())
	</insert>
	
	<!-- =============================== DELETE =============================== -->
	<delete id="deleteMemberVerify">
		delete from me_verify where mv_me_id = #{me_id}
	</delete>
	
	<!-- =============================== UPDATE =============================== -->	
	
	<update id="updateProfile">
		update member set me_interests = #{member.me_interests}, me_preferloc = #{member.me_preferloc}, me_prefertime = #{member.me_prefertime}, me_onoff = #{member.me_onoff}, me_intro = #{member.me_intro}
		where me_id = #{me_id}
	</update>
	
	  <update id="updateMemberCookie">
	  	update member set 
	  		me_cookie = #{user.me_cookie},
	  		me_cookie_limit = #{user.me_cookie_limit}
	  	where
	  		me_id = #{user.me_id}
 	 </update>
	
	<update id="updateMemberPwToTemp">
		update member set
			me_pw = #{member.me_pw},
			me_temppw = 1
		where
			me_id = #{member.me_id}
	</update>
	
	<update id="updateMemberPwToNorm">
		update member set
			me_pw = #{cpt.me_pw},
			me_temppw = 0
		where
			me_id =#{cpt.me_id}
	</update>
	<!-- =============================== SELECT =============================== -->	
	
	<select id="findMemberById" resultType="MemberVO">
		SELECT * FROM member WHERE me_id = #{id}
	</select>
	
	<select id="findMemberByNickname" resultType="MemberVO">
		SELECT * FROM member WHERE me_nickname = #{nickname}
	</select>
	
	<!-- 회원 정보 가져오기 -->
	<select id="selectMember" resultType="MemberVO">
		SELECT * FROM member WHERE me_id = #{me_id}
	</select>
	
	<select id="idFind" resultType="String">
		select me_id from member where me_name = #{me_name} and me_phone = #{me_phone}
	</select>
	
	<select id="pwFind" resultType="MemberVO">
		select * from member where me_id = #{me_id} and me_phone = #{me_phone}
	</select>
	
	<select id="selectMemberByCookie" resultType="MemberVO">
	  	<![CDATA[
	  	select * from member where 
	  		me_cookie = #{session_id} and me_cookie_limit >= now()
	 	]]>
	</select>
	
	<select id="selectMeVerify" resultType="MeVerifyVO">
		<![CDATA[
		select * 
		from me_verify
		where mv_me_id = #{mv.mv_me_id} and mv_code = #{mv.mv_code}
			  and mv_createtime <= NOW() and mv_exptime >= NOW()
		]]>
	</select>

</mapper>